name: Debug AI GitHub Tracker

on:
  workflow_dispatch:  # åªæ”¯æŒæ‰‹åŠ¨è§¦å‘

permissions:
  contents: write  # å…è®¸ä¿®æ”¹ä»“åº“å†…å®¹
  actions: read    # å…è®¸è¯»å–Actions

jobs:
  debug_track_ai_projects:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Check environment and configuration
      env:
        GH_TOKEN: ${{ secrets.GH_TOKEN }}
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        echo "ğŸ” ç¯å¢ƒæ£€æŸ¥:"
        echo "Pythonç‰ˆæœ¬: $(python --version)"
        echo "GH_TOKENè®¾ç½®: $([[ -n "$GH_TOKEN" ]] && echo 'âœ… å·²è®¾ç½®' || echo 'âŒ æœªè®¾ç½®')"
        echo "DISCORD_WEBHOOK_URLè®¾ç½®: $([[ -n "$DISCORD_WEBHOOK_URL" ]] && echo 'âœ… å·²è®¾ç½®' || echo 'âš ï¸ æœªè®¾ç½®')"
        echo ""
        echo "ğŸ“‚ æ–‡ä»¶æ£€æŸ¥:"
        ls -la
        echo ""
        echo "ğŸ“Š å½“å‰ç»Ÿè®¡:"
        python ai_tracker.py --stats || echo "æ— ç»Ÿè®¡æ•°æ®"

    - name: Reset and run tracker (debug mode)
      env:
        GH_TOKEN: ${{ secrets.GH_TOKEN }}
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        echo "ğŸ”„ é‡ç½®æ¨é€è®°å½•ä»¥ç¡®ä¿æœ‰å†…å®¹æ¨é€..."
        python ai_tracker.py --reset
        echo ""
        echo "ğŸš€ è¿è¡ŒAIè¿½è¸ªå™¨ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰..."
        python ai_tracker.py 2>&1 | tee tracker_output.log
        echo ""
        echo "ğŸ“ˆ è¿è¡Œåç»Ÿè®¡:"
        python ai_tracker.py --stats

    - name: Test different timeframes
      env:
        GH_TOKEN: ${{ secrets.GH_TOKEN }}
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        echo "ğŸ“Š æµ‹è¯•30å¤©è¶‹åŠ¿..."
        python ai_tracker.py --trend-timeframe 30days || echo "30å¤©è¶‹åŠ¿æµ‹è¯•å¤±è´¥"
        echo ""
        echo "ğŸš€ æµ‹è¯•7å¤©è¶‹åŠ¿..."
        python ai_tracker.py --trend-timeframe 7days || echo "7å¤©è¶‹åŠ¿æµ‹è¯•å¤±è´¥"

    - name: Show detailed output
      run: |
        echo "ğŸ“‹ è¯¦ç»†è¾“å‡ºæ—¥å¿—:"
        if [ -f tracker_output.log ]; then
          cat tracker_output.log
        else
          echo "æ— æ—¥å¿—æ–‡ä»¶"
        fi
        echo ""
        echo "ğŸ“ æœ€ç»ˆæ–‡ä»¶çŠ¶æ€:"
        ls -la
        if [ -f sent_projects.json ]; then
          echo "sent_projects.json å†…å®¹:"
          head -20 sent_projects.json
        fi

    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action Debug"
        git add sent_projects.json
        if git diff --cached --quiet; then
          echo "No changes to commit"
        else
          git commit -m "Debug run - Update sent projects - $(date '+%Y-%m-%d %H:%M:%S')"
          git push
        fi